% Author: Seongjin Lee 
% Hanyang University, Seoul, Korea 
% esos.hanyang.ac.kr 
% 2016-09-20
% note: some slides are adopted from  \url{www.cs.stevens.edu/~jschauma/631A/}
% https://github.com/resourceful/lecture_sysprog/

\documentclass[newPxFont,sthlmFooter,nooffset]{beamer}
\usepackage{kotex}
%\usetheme{sthlm}
\usepackage{../beamer_template/beamerthemesthlm}
\hypersetup{pdfauthor={Seongjin Lee (insight@hanyang.ac.kr)},
            pdfsubject={Lecture Note: System Programming},
            pdfkeywords={Lecture Note, System Programming, class, undergraduate},
            pdfmoddate={D: \pdfdate},
            pdfcreator={Seongjin Lee}}

%\setbeamertemplate{footline}[text line]{%
%    \parbox{\linewidth}{\vspace*{-8pt} \insertsectionhead  \hfill\insertshortauthor\hfill\insertpagenumber}}
%\setbeamertemplate{navigation symbols}{}



\title{System Programming}
\subtitle{Week 4: Files and Directories}
\author[SJL]{Seongjin Lee}
\institute{\href{mailto:insight@hanyang.ac.kr}{insight@hanyang.ac.kr}\\\url{http://esos.hanyang.ac.kr}\\Esos Lab. Hanyang University}
\date{2016-09-27} 

\begin{document}



\frame[plain]{\titlepage} 

\frame{\frametitle{Table of contents}\tableofcontents} 


%---------------------------------------------------------

\begin{frame}[t]
  \frametitle{introduction}
Additional features of the file system and the properties of a file
\begin{itemize}
\item \texttt{stat} function and its structure
\item modifying the attributes: Owner, Permissions, etc.
\item \textsc{Unix} file system structure and symbolic links
\item functions that operate on directories
\end{itemize}
\end{frame}

\section{stat structures}

\begin{frame}[containsverbatim,t]
  \frametitle{stat and Related Functions}
\begin{codedef}
#include <sys/stat.h>
int stat(const char *restrict pathname, struct stat *restrict buf );
int fstat(int fd, struct stat *buf);
int lstat(const char *restrict pathname, struct stat *restrict buf );
int fstatat(int fd, const char *restrict pathname, struct stat *restrict buf, int flag);
&&\hfill // All four return: 0 if OK, âˆ’1 on error 
\end{codedef}

\texttt{stat}: returns a structure of information about the file at \textit{pathname}

\texttt{fstat}: obtains information about the file that is already open on the descriptor \texttt{fd}

\texttt{lstat}: returns info about the symbolic link, not the file referenced by the symbolic link

\texttt{fstatat} returns the file statistics for a pathname relative to an open directory represented by the \texttt{fd}

\end{frame}

\begin{frame}[containsverbatim,t]
  \frametitle{Definition of the stat Structure}
\begin{codedef}
struct stat {
   mode_t	st_mode;	/* file type & mode (permissions) */
   ino_t	st_ino;	/* i-node number (serial number) */
   dev_t	st_dev;	/* device number (file system) */
   dev_t	st_rdev;	/* device number for special files */
   nlink_t	st_nlink;	/* number of links */
   uid_t	st_uid;	        /* user ID of owner */
   gid_t	st_gid;	        /* group ID of owner */
   off_t	st_size;	/* size in bytes, for regular files */
   struct timespec st_atim;	/* time of last access */
   struct timespec st_mtim;	/* time of last modification */
   struct timespec st_ctim;	/* time of last file status change */
   blksize_t       st_blksize; /* best I/O block size */		
   blkcnt_t        st_blocks;  /* number of disk blocks allocated */		
};		
\end{codedef}

Note that most members of the \texttt{stat} structure are specified by a \textit{primitive system data type} (see Section 2.8, header \texttt{<sys/types.h>})
\end{frame}

\begin{frame}[t]
  \frametitle{File Types}
Everything is a file in \textsc{Unix}. There are .... 
\begin{itemize}
\item Regular file: {\footnotesize The most common type, and there is
    no disctiction whether the data is text or binary. Application is
    responsible for interpreting}
\item Directory file: {\footnotesize A file that contains the name of
    other files and pointers to information on these files. Any
    process can read, only kernel can write.}
\item Block sepcial file: {\footnotesize A type of file providing
    buffered I/O access in fixed-size units to devices such as disk
    drives}
\item Character special file: {\footnotesize A type of file providing
    unbuffered I/O access in variable-sized units to devices}
\item FIFO: {\footnotesize A Type of file used for communication
    between processes}
\item Socket: {\footnotesize A type of file used for network
    communication between processes}
\item Symbolic Link: {\footnotesize A type of file that points to another file}
\end{itemize}
\end{frame}

\begin{frame}[t]
  \frametitle{File Types Cnt'd}
The type of a file is encoded in the \texttt{st\_mode} member of the \texttt{stat} structure

\begin{center}
  \begin{tabular}[t]{c | c}
  \caption{File type macros in \texttt{<sys/stat.h>}}
    Macro & Type of file \\ \hline
    \texttt{S\_ISREG()}	&	regular file	\\  \hline
    \texttt{S\_ISDIR()}	&	directory file	\\  \hline
    \texttt{S\_ISCHR()}	&	character special file	\\  \hline
    \texttt{S\_ISBLK()}	&	block special file	\\  \hline
    \texttt{S\_ISFIFO()}	&	pipe or FIFO	\\  \hline
    \texttt{S\_ISLNK()}	&	symbolic link	\\  \hline
    \texttt{S\_ISSOCK()}	&	socket 	\\  
  \end{tabular}
\end{center}

\end{frame}

\begin{frame}[containsverbatim,t]
  \frametitle{File Types Cnt'd}
First, let's review \texttt{./codes/myls.c}
  \lstinputlisting[linerange={17,33},lineskip=-5pt]{./codes/myls.c}
\end{frame}

\begin{frame}
  \frametitle{Let's improve the code (myls.c, Fig. 4.3)}
The code at the moment does not show file types. 

Make changes to the code such that it prints out the file types. 

Use Fig. 4.3 as reference.
  
\end{frame}

\section{Attributes}

\section{File System Structures}

\section{Directories}




\end{document}
